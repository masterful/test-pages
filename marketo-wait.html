<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <title>Waiting for Marketo</title>
</head>
<body>
  <h1>Waiting for Marketo</h1>
  <p>(It can take some time for that form submission to actually start returning the information that was just submitted ...)</p>
  <p id="dots"></p>
  <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js?ver=2.2.4'></script>
  <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js?ver=1.4.1'></script>
  <script>
    var dots = document.getElementById('dots');
    var url = '//app-sj04.marketo.com/index.php/form/getKnownLead?_mkt_trk=';
    url += encodeURIComponent($.cookie('_mkto_trk'));
    url += '&form=1407&munchkinId=103-MWY-702&filledFields=false&callback=?';
    
    var interval = setInterval(function() {
      $.getJSON(url, function(data) {
        if (!data || !data.FirstName) {
          console.log('Nothing yet ...');
          dots.innerHTML += '.';
          return;
        }
        window.location = 'https://masterful.github.io/test-pages/stranger-views.html';
      });
    }, 2000);
  </script>
</body>
</html>
